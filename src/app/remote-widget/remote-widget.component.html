<p-dialog [modal]="false" position="topright" [showHeader]="true" [closable]="false" [visible]="visible" [draggable]="true"
          contentStyleClass="widget-dialog" class="widget" styleClass="widget-header" appendTo="body">
  <ng-template pTemplate="header">
      <div class="flex justify-content-between flex-wrap gap-3 column-gap-4" style="width: 100%">
        <div class="flex align-items-center justify-content-center">
          <p-button icon="pi pi-window-minimize" pTooltip="Minimize" (click)="minimized = !minimized"/>
        </div>
        <div class="flex align-items-center overflow-hidden" style="max-width: 250px">
          <app-scrolling-text [text]="remoteWebsocketService.getMediaInfo()"/>
        </div>
        <div class="flex align-items-center justify-content-center" *ngIf="remoteState?.batteryInfo?.capacity" style="width:40px">
          <div class="flex align-items-center justify-content-center">{{remoteState!.batteryInfo!.capacity!}}%</div>
          <div style="position: relative">
            <div class="icon icon-battery" *ngIf="remoteState!.batteryInfo!.capacity!> 30 && remoteState!.batteryInfo!.capacity! < 85"></div>
            <div class="icon icon-battery-low" *ngIf="remoteState!.batteryInfo!.capacity! <= 30"></div>
            <div class="icon icon-battery-full" *ngIf="remoteState!.batteryInfo!.capacity! >= 85"></div>
            <div class="pi pi-bolt charging-status" *ngIf="remoteState!.batteryInfo?.status === 'CHARGING'"></div>
          </div>

        </div>
        <div class="flex align-items-center justify-content-center">
          <p-tag [value]="(remoteWebsocketService.connectionStatus | async) ? 'Connected' : 'Disconnected'"
                 [severity]="(remoteWebsocketService.connectionStatus  | async) ? 'success' : 'warning'"/>
        </div>
    </div>
  </ng-template>
  <ng-container *ngIf="!minimized">
    <ng-container *ngIf="mediaEntity && selectedRemote">
      <div class="flex flex-column align-items-center justify-content-center">
      <div class="flex gap-2 align-content-center justify-content-center" style="width: 675px">
      <app-media-entity [mediaEntity]="mediaEntity" [remote]="selectedRemote" style="width: 675px"
                        class="flex flex-wrap gap-2 align-content-center justify-content-center ng-star-inserted"
                        [headerTemplate]="entitySelector">
        <ng-template #entitySelector>
          <div class="flex align-items-center justify-content-center" style="width: 100%">
            <p-dropdown [(ngModel)]="mediaEntity" [options]="mediaEntities" placeholder="Media entity" appendTo="body"
                        (ngModelChange)="changedMediaEntity($event)" optionLabel="entity_id">
              <ng-template pTemplate="selectedItem">
                {{remoteWebsocketService.getEntityName(mediaEntity)}}
              </ng-template>
              <ng-template let-item pTemplate="item">
                {{remoteWebsocketService.getEntityName(item)}}
              </ng-template>
            </p-dropdown>
          </div>
        </ng-template>
      </app-media-entity>
      </div>
      </div>
    </ng-container>
  </ng-container>
</p-dialog>
